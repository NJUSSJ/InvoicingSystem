# 进销存系统软件体系结构描述文档

1. ##引言

    ####1.1编制目的

   本报告详细完成对进销存系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。
   本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

  ### 1.2词汇表

| 词汇名称        | 词汇含义             | 备注   |
| ----------- | ---------------- | ---- |
| *ui         | 表示某展示层           |      |
| *bl         | 表示某逻辑层           |      |
| *data       | 表示某数据层           |      |
| RMI         | 表示远程方法调用         |      |
| utilitybl   | 表示初始化和业务逻辑上下文的工作 |      |
| datafactory | 表示调用其他数据库的方法     |      |

###   1.3参考资料

1.IEEE std 1471-2000

2.丁二玉，刘钦.计算与软件工程（卷二）[M]机械工业出版2012：134—182

##2. 产品概述

  参考进销存系统用例文档和进销存系统需求规格说明文档中对产品的概括描述。



##3. 逻辑视角

  进销存管理系统中，选择了分层体系结构风格，将系统分为三层（展示层、业务逻辑层、数据层）能够很好的示意整个高层抽象。展示层包含GUI界面的实现，业务逻辑层包含业务逻辑的处理实现，数据层包括数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案如图1图2（文档外）所示。

## 4.组合视角

[软工2 166]与抽象的逻辑设计相比，实现物理设计要考虑更多的实现细节，这些细节有：

1）presentation层与logic层被置于客户端，data层被置于服务器端，那么logic层的开发包不可能依赖于data层的开发包。使用RMI技术，将data层开发包分解为置于客户端的data_service接口包和置于服务器端的data层开发包。这样一来，logic层开发包依赖于data_service包，data_service包和data层的开发包都依赖于RMI类库包。

2）所有的data层开发包都需要进行数据持久化（例如读写数据库、读写文件等），所以它们会有一些重复代码，可以将重复代码独立为新的开发包，然后所有的data层开发包都依赖于databaseutility。datavaseutility会依赖于JDBC类库包。

3）所有的presentation层开发包都需要使用图形类型建立界面，都要依赖于图形界面类库包。

4）此外，presentation层实现时，由main_ui包负责整个页面之间的跳转逻辑。其他各包负责各自页面自身的功能。

5）在分层风格的典型设计中，不希望高层直接依赖于低层，而是为低层建立接口包，实现依赖倒置原则，所以应该调整为：各presentation层开发包（调用）依赖于logic层接口包businesslogicservice包，logic层开发包也依赖于（实现了）logic层接口包businesslogicservice包。

6）在分层风格的典型设计中，presentation层与logic层之间、logic层与data层之间可能会传递复杂数据对象，那么相邻两层都需要使用数据对象声明，所以需要将数据对象声明独立为开发包（VO包和PO包）。

7） 使用依赖倒置原则来消除包的循环依赖问题，将循环依赖变为单向依赖：

- ​	Commodity和Bill：将部分Bill类抽象接口置入Commodity类，这样Bill单向依赖于Commodity

8） 在logic层中，初始化和业务逻辑层上下文的工作被分配到utilitybl包中。

 ###  4.1开发包图

进销存系统的最终开发包图的设计如表1所示

##### 表1   进销存管理系统的最终开发包设计

| 开发（物理）包              | 依赖的其他开发包                                 |
| -------------------- | ---------------------------------------- |
| mainui               | salesui，commdityui，memberui，promotionui，userui，accountui，tableui，billui，vo |
| salesui              | salesblservice,界面类库包,vo                  |
| salesblservice       |                                          |
| salesbl              | salesblservice，salesdataservice，po，userbl，promotionbl，commoditybl |
| salesdataservice     | Java RMI，po                              |
| salesdata            | databaseutility，po，salesdataservice      |
| commodityui          | commodityblservice，界面类库包                 |
| commodityblservice   |                                          |
| commoditybl          | commodityblservice，commoditydataservice，po，billbl |
| commoditydataservice | Java RMI，po                              |
| commoditydata        | Java RMI，po，databaseutility              |
| memberui             | memberblservice，界面类库包                    |
| memberblservice      |                                          |
| memberbl             | memberblservice，memberdataservice，po，commditybl， billbl |
| memberdataservice    | Java RMI，po                              |
| memberdata           | Java RMI，po，databaseutility              |
| promotionui          | promotionblservice，界面类库包                 |
| promotionblservice   |                                          |
| promotionbl          | promotionblservice，promotiondataservice，commditybl，memberbl， vo |
| promotiondataservice | Java RMI，po                              |
| promotiondata        | Java RMI，po，databaseutility              |
| userui               | userblservice，界面类库包                      |
| userblservice        |                                          |
| userbl               | Userinterface，Userdataclient，Userpo      |
| userdataservice      | Java RMI，po                              |
| userdata             | RMI，po，databaseutiity                    |
| accountui            | accountblservice，界面类库包                   |
| accountblservice     |                                          |
| accountbl            | accountblservice，accountdataservice，po， billbl |
| accountdataservice   | Java RMI，po                              |
| accountdata          | Java RMI，po，databaseutility              |
| tableui              | tableblservice，界面类库包                     |
| tableblservice       |                                          |
| tablebl              | tableblservice，tabledataservice，po，billbl，commoditybl |
| tabledataservice     | Java RMI，po                              |
| tabledata            | Java RMI，po，databaseutility              |
| billui               | billblservice，界面类库包                      |
| billblservice        |                                          |
| billbl               | billblservice，billdataservice，po，salebl  |
| billdataservice      | Java RMI，po                              |
| billdata             | Java RMI，po，databaseutility              |
| vo                   |                                          |
| po                   |                                          |
| utilitybl            |                                          |
| 界面类库包                |                                          |
| Java RMI             |                                          |
| databaseutility      | JDBC                                     |

进销存管理系统客户端开发包图如图3所示，服务器端开发包图如图4所示。

### 4.2运行时进程

​	在进销存管理系统中，会有多个客户端进程和一个服务器进程，其进程图如文档外进程图（图5）所示。结合部署图，客户端进程是在客户端机器上运行，服务器进程在服务器端机器上运行。

### 4.3物理部署

进销存管理系统中客户端构件是放在客户端机器上，服务器端构件是放在服务器机器上。在客户端节点上，还要部署RMIStub构件。由于Java RMI构件属于JDK 6.0 的一部分。所以，在系统JDK环境已经设置好的情况下，不需要再独立部署。部署图如文档外部署图（图6）所示。

##5.接口视角

### 5.1模块的职责

客户端模块和服务器模块视图如文档外模块视图(图7 图8)所示

客户端各层和服务器各层的职责分别如表2和表3所示



#####                                                                                              表2 客户端各层的职责

|    层    |                  职责                  |
| :-----: | :----------------------------------: |
|  启动模块   |          负责初始化网路通信机制，启动用户界面          |
|  用户界面层  |          基于窗口的进销存系统客户端用户界面           |
|  业务逻辑层  |        对于用户界面的输入进行响应并进行业务处理逻辑        |
| 客户端网络模块 | 利用Java RMI机制查找RMI服务，，检测网络连接状态，进行短线重连 |



#####                                                                                             表3 服务器端各层的职责

|    层     |             职责              |
| :------: | :-------------------------: |
|   启动模块   |     负责初始化网路通信机制，启动用户界面      |
|   数据层    |      负责数据的持久化以及数据访问接口       |
| 服务器端网络模块 | 利用Java RMI机制查找RMI服务，注册RMI服务 |

每层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层之间调用的接口如表4所示。

##### 表4 层之间调用的接口

| 接口                                       | 服务调用方    | 服务提供方    |
| ---------------------------------------- | -------- | -------- |
| userblservice<br>saleblservice<br>memberblservice<br>commodityblservice<br>promotionblservice<br>tableblservice<br>billblservice<br>accountblservice | 客户端展示层   | 客户端业务逻辑层 |
| userdataservice<br>saledataservice<br>memberdataservice<br>commoditydataservice<br>promotiondataservice<br>tabledataservice<br>billdataservice<br>accountdataservice<br>datafactoryservice | 客户端业务逻辑层 | 服务器端数据层  |

借用库存管理用例来说明层与层之间的调用，如文档外图“库存管理层与层之间调用的接口”（图9）所示。每一层之间都是由上层依赖了一个接口（需接口),而下层实现了这个接口（供接口）。CommodityBlService提供了Commodity界面所需要的业务逻辑功能。CommodityDataService提供了对数据库的增删查改等操作。这样的实现就大大降低了层与层之间的耦合度。

### 5.2用户界面层的分解

根据需求，系统存在27个用户界面，界面跳转如图10所示。

服务器端和客户端用户界面设计接口一直，只是具体界面不一样。用户界面类如图11所示。

####5.2.1用户界面层模块的职责

如表5所示为用户界面层模块职责。

##### 表5 用户界面层模块职责

| 模块                 | 职责                     |
| ------------------ | ---------------------- |
| MainFrame          | 界面Frame，负责界面的显示和界面的跳转  |
| SaleMainPanel      | 负责销售活动界面的显示和销售相关界面间的跳转 |
| MemberPanel        | 负责客户管理界面的显示            |
| ImportPanel        | 负责进货（制定进货单据）界面的显示      |
| Import_ReturnPanel | 负责进货退货界面的显示（制定进货单据）    |
| SalePanel          | 负责销售界面的显示（制定销售单据）      |
| Sale_ReturnPanel   | 负责销售退货界面的显显示（制定销售退货单）  |



####5.2.2 用户界面层模块的接口规范

用户界面层模块的接口规范如表6所示。

##### 表6 用户界面层模块接口规范

MainFrame：

| 语法   | init（args：String[]） |
| ---- | ------------------- |
| 前置条件 | 无                   |
| 后置条件 | 显示Frame以及LoginPanel |


SaleMainUI:

| 语法   | init（args：String[]）      |
| ---- | ------------------------ |
| 前置条件 | 销售进货人员登录                 |
| 后置条件 | 显示销售人员主界面（SaleMainPanel） |

MemberUI:

| 语法   | init（args：String[]）   |
| ---- | --------------------- |
| 前置条件 | 进货销售人员选择管理客户          |
| 后置条件 | 显示客户管理界面（MemberPanel） |

ImportUI:

| 语法   | init（args：String[]）      |
| ---- | ------------------------ |
| 前置条件 | 销售进货人员选择制定进货单据           |
| 后置条件 | 显示销售界面（制定销售单据）(ImportUI) |

Import_ReturnUI:

| 语法   | init（args：String[]）           |
| ---- | ----------------------------- |
| 前置条件 | 进货销售人员选择进货退货                  |
| 后置条件 | 显示制定进货退货单据界面（Import_ReturnUI） |

SaleUI:
| 语法   | init（args：String[]） |
| ---- | ------------------- |
| 前置条件 | 进货销售人员选择销售          |
| 后置条件 | 显示制定销售单据界面（SaleUI）  |

Sale_ReturnUI:
| 语法   | init（args：String[]）        |
| ---- | -------------------------- |
| 前置条件 | 进货销售人员选择销售退货               |
| 后置条件 | 显示制定销售退货单界面（Sale_ReturnUI） |


用户界面所需的服务接口如表7所示

##### 表7 用户界面层模块所需的服务接口

| 服务名                                      | 服务            |
| ---------------------------------------- | ------------- |
| businesslogicservice.LoginBLService      | 登录界面的业务逻辑接口   |
| businesslogicservice.SaleMainBLService   | 销售人员主界面业务逻辑接口 |
| businesslogicservice.MemberBLService     | 客户管理界面的业务逻辑接口 |
| businesslogicservice.ImportBLService     | 进货界面的业务逻辑接口   |
| businesslogicservice.Import_ReturnBLService | 进货退货界面的业务逻辑   |
| businesslogicservice.SaleBLService       | 销售界面的业务逻辑接口   |
| businesslogicservice.Sale_ReturnBLService | 销售退货界面的业务逻辑接口 |

#### 5.2.3 用户界面模块设计原理

用户界面利用Java的JavaFx库来实现。

### 5.3 业务逻辑层的分解

业务逻辑层包括多个针对界面的业务逻辑处理对象。例如，User对象负责处理登录界面的业务逻辑；Sales对象负责销售界面的业务逻辑。业务逻辑层的设计如文档外“业务逻辑层的设计”（图12）所示。

####5.3.1 业务逻辑层模块的职责

业务逻辑层模块的职责如表8所示

##### 表8 业务逻辑层模块的职责

| 模块          | 职责                   |
| ----------- | -------------------- |
| salebl      | 负责实现销售进货人员界面所需要的服务   |
| userbl      | 负责实现用户管理界面与登录界面所需的服务 |
| commoditybl | 负责实现库存管理与商品管理界面所需的服务 |
| tablebl     | 负责实现表格查看界面所需的服务      |
| billbl      | 负责实现表单制定与查看界面所需的服务   |
| accountbl   | 负责实现银行账户管理界面所需的服务    |
| memberbl    | 负责实现客户管理界面所需的服务      |
| promotionbl | 负责实现制定促销策略界面所需的服务    |

#### 5.3.2 业务逻辑层模块的接口规范

#####commoditybl模块的接口规范

提供的服务（供接口）

Commodity.getCommodityList

| 语法   | public CommodityListVO getCommodityList(String field) |
| ---- | ---------------------------------------- |
| 前置条件 | 查询关键字正确或选择了某个门类或选择查看库存，库存管理人员已登录         |
| 后置条件 | 获返回商品列表信息                                |

Commodity.getCommodity

| 语法   | public CommodityVO getCommodity(String field) |
| ---- | ---------------------------------------- |
| 前置条件 | 选择查询某个具体商品或查询关键字正确，库存管理人员已登录             |
| 后置条件 | 返回商品信息                                   |

Commodity.getCategoryList

| 语法   | public CategoryListVO getCategory() |
| ---- | ----------------------------------- |
| 前置条件 | 选择进入商品分类管理界面，库存管理人员已登录              |
| 后置条件 | 返回分类列表信息                            |

Commodity.addCommodity

| 语法   | public ResultMessage addCommodity(Commodity c) |
| ---- | ---------------------------------------- |
| 前置条件 | 选择新增商品且商品信息填写完整且符合要求，库存管理人员已登录           |
| 后置条件 | 新增商品并将其作为持久化对象插入数据库，返回维护结果               |

Commodity.addCategory

| 语法   | public ResultMessage addCategory(Category c) |
| ---- | ---------------------------------------- |
| 前置条件 | 选择新增分类，分类信息填写完整，库存管理人员已登录                |
| 后置条件 | 新增分类并将其作为持久化对象插入数据库，返回维护结果               |

Commodity.deleteCommodity
| 语法   | public ResultMessage deleteCommodity(Commodity c) |
| ---- | ---------------------------------------- |
| 前置条件 | 选择删除商品，库存管理人员已登录                         |
| 后置条件 | 删除商品并从数据库中删除单一持久化对象，返回维护结果               |


Commodity.deleteCategory

| 语法   | public ReaultMessage deleteCategory(Category c) |
| ---- | ---------------------------------------- |
| 前置条件 | 选择删除分类，库存管理人员已登录                         |
| 后置条件 | 删除分类并从数据库中删除单一持久化对象，返回维护结果               |

Commodity.modifyCommodity

| 语法   | public ResultMessage modifyCommodity(Commodity c) |
| ---- | ---------------------------------------- |
| 前置条件 | 选择修改商品，库存管理人员已登录                         |
| 后置条件 | 更新商品并从数据库中更新单一持久化对象，返回维护结果               |


Commodity.modifyCategory

| 语法   | public ResultMessage  modifyCategory(Category c) |
| ---- | ---------------------------------------- |
| 前置条件 | 选择修改分类，库存管理人员已登录                         |
| 后置条件 | 更新分类并从数据库中更新单一持久化对象，返回维护结果               |

需要的接口（需接口）

| 服务名                                      | 服务                   |
| ---------------------------------------- | -------------------- |
| CommodityDataService.find(int id)        | 根据ID查找单一持久化对象        |
| CommodityDataService.finds(String field,int value) | 根据字段名称和值查找多个持久化对象    |
| CommodityDataService.insert(CommodityPO po) | 插入单一持久化对象            |
| CommodityDataService.delete(CommodityPO p) | 删除单一持久化对象            |
| CommodityDataService.update(CommodityPO p) | 更新单一持久化对象            |
| DatabaseFactory.getCommodityDatabase     | 得到Commodity数据库的服务的引用 |

##### accountbl模块的接口规范

提供的服务（供接口）

Account.getAccount

| 语法   | public AccountPO getAccount() |
| ---- | ----------------------------- |
| 前置条件 | 选择查看某具体银行账户信息，财务人员已登录         |
| 后置条件 | 返回账户信息                        |

Account.addAccount

| 语法   | public ResultMessage addAccount() |
| ---- | --------------------------------- |
| 前置条件 | 选择增加银行账户信息，财务人员已登录                |
| 后置条件 | 增加账户信息，向数据库插入单一持久化对象，返回维护结果       |

Account.deleteAccount

| 语法   | public ResultMessage deleteAccount() |
| ---- | ------------------------------------ |
| 前置条件 | 选择删除银行账户信息，财务人员已登录                   |
| 后置条件 | 删除账户信息，从数据库删除单一持久化对象，返回维护结果          |

Account.modifyAccount
| 语法   | public ResultMessage modifyAccount() |
| ---- | ------------------------------------ |
| 前置条件 | 选择更新银行账户信息，财务人员已登录                   |
| 后置条件 | 更新账户信息，从数据库更新单一持久化对象，返回维护结果          |

Account.getAccountList

| 语法   | public AccountListPO getAccountList() |
| ---- | ------------------------------------- |
| 前置条件 | 选择查看账户列表，财务人员已登录                      |
| 后置条件 | 返回账户列表信息                              |

需要的接口（需接口）

| 服务名                                      | 服务                   |
| ---------------------------------------- | -------------------- |
| AccountDataService.find(int id)          | 根据ID查找单一持久化对象        |
| AccountDataService.finds(String field,int value) | 根据字段名称和值查找多个持久化对象    |
| AccountDataService.insert(CommodityPO po) | 插入单一持久化对象            |
| AccountDataService.delete(CommodityPO p) | 删除单一持久化对象            |
| AccountDataService.update(CommodityPO p) | 更新单一持久化对象            |
| DatabaseFactory.getCommodityDatabase     | 得到Commodity数据库的服务的引用 |

### 5.4数据层的分解

​	数据层主要给业务逻辑层提供数据访问服务，包括对持久化数据的增删查改。例如Sale业务逻辑所需要的服务由SaleDataService接口提供。由于持久化数据的保存可能存在多种形式：Txt问文件，序列化文件，数据库等，所示抽象了数据服务。数据层模块的描述具体如图13。

#### 5.4.1数据层模块的职责

数据层模块的职责如表所示

| 模块                      | 职责                                  |
| ----------------------- | ----------------------------------- |
| DataService             | 持久化数据库的接口，提供集体载入、集体保存、增删查改的功能       |
| DataServiceTxtFileImpl  | 基于Txt文件的持久化数据接口，提供集体载入、集体保存、增删查改的功能 |
| DataServiceDatabaseImpl | 基于数据库的持久化数据接口，提供集体载入、集体保存、增删查改的功能   |

